#!/bin/bash

set -e
set -x

function userdata() {
        exec 2>&1

    echo "+++ Installing Ruby1.9.1(but it's really 1.9.2)"
    sudo add-apt-repository ppa:johnf-inodes/ruby192
    sudo apt-get update
    sudo apt-get -y install ruby1.9.1-dev=1.9.2-p0~ppa1-1 ruby1.9.1=1.9.2-p0~ppa1-1
    echo "++++ Setting up system links"
# this is totally hacky and should be replaced with some find fu.
#erb1.9.1  gem1.9.1  irb1.9.1  rake1.9.1  rdoc1.9.1    testrb1.9.1
    sudo ln -s /usr/bin/ruby1.9.1 /usr/bin/ruby
    sudo ln -s /usr/bin/ruby1.9.1 /usr/bin/ruby
    sudo ln -s /usr/bin/ruby1.9.1 /usr/bin/ruby
    sudo ln -s /usr/bin/ruby1.9.1 /usr/bin/ruby
    sudo ln -s /usr/bin/ruby1.9.1 /usr/bin/ruby
    sudo gem install chef -v=0.9.12 --no-rdoc --no-ri
    sudo ln -s /var/lib/gems/1.8/bin/* /usr/local/bin/
}

userdata > /var/log/userdata.log


